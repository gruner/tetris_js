!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function BufferLoader(ctx,urlList,callback){this.ctx=ctx,this.urlList=urlList,this.onload=callback,this.bufferList={},this.loadCount=0}var debug=require("./debug");BufferLoader.prototype.loadBuffer=function(key,url){var request=new XMLHttpRequest;request.open("GET",url,!0),request.responseType="arraybuffer";var loader=this;request.onload=function(){loader.ctx.decodeAudioData(request.response,function(buffer){return buffer?(loader.bufferList[key]=buffer,void(++loader.loadCount===Object.keys(loader.urlList).length&&loader.onload(loader.bufferList))):void debug.log("error decoding file data: "+url)},function(error){debug.log("decodeAudioData error",error)})},request.onerror=function(){debug.log("BufferLoader: XHR error")},request.send()},BufferLoader.prototype.load=function(){for(var key in this.urlList)this.loadBuffer(key,this.urlList[key])},module.exports=BufferLoader},{"./debug":8}],2:[function(require,module,exports){"use strict";module.exports={gridSize:30,playfieldOrigin:{x:0,y:0},blockBorderWidth:1,transpose:function(value){return this.gridSize*value}}},{}],3:[function(require,module,exports){"use strict";module.exports={DIRECTION_LEFT:"left",DIRECTION_RIGHT:"right",DIRECTION_DOWN:"down",DIRECTION_UP:"up"}},{}],4:[function(require,module,exports){"use strict";module.exports={moveActivePiece:"tetris.moveActivePiece",rotateActivePiece:"tetris.rotateActivePiece",accelerateActivePiece:"tetris.accelerateActivePiece",deccelerateActivePiece:"tetris.accelerateActivePiece",activePiecePositioned:"tetris.activePiecePositioned",rowComplete:"tetris.rowComplete",rowCleared:"tetris.rowCleared",playfieldSettled:"tetris.playfieldSettled",invalidMove:"tetris.invalidMove",topOut:"tetris.topOut",pause:"tetris.pause"}},{}],5:[function(require,module,exports){"use strict";var features={testMovementMode:{desc:"Allows free movement of a single tetromino without it falling",enabled:!1},initWithRemnants:{desc:"Starts the game with remnant blocks already on the playfield",enabled:!1},displayGhostPiece:{desc:"Highlights where the current piece will land",enabled:!0,"public":!0}};module.exports={enable:function(featureKey){features.hasOwnProperty(featureKey)&&(features[featureKey].enabled=!0)},enabled:function(featureKey){return features.hasOwnProperty(featureKey)&&features[featureKey].enabled===!0},set:function(featureKey,featureConfig){featureConfig.hasOwnProperty("enabled")&&(features[featureKey]=featureConfig)},getPublic:function(){var publicFeatures={};for(var feature in features)features[feature]["public"]===!0&&(publicFeatures[feature]=features[feature]);return publicFeatures}}},{}],6:[function(require,module,exports){"use strict";module.exports={activePieceLock:"sounds/activePieceLock.mp3",rowComplete:"sounds/lineClear.mp3",gameOver:"sounds/gameOver.mp3"}},{}],7:[function(require,module,exports){"use strict";module.exports={"default":{playfield:{color:"#000000"},ghostPiece:{color:"#333333"},tetrominos:{i:{color:"#dd5b4d"},o:{color:"#4f718b"},t:{color:"#4ab18f"},j:{color:"purple"},l:{color:"#eec857"},s:{color:"#e07a46"},z:{color:"#e07a46"}},tetrominoBorder:{color:"#000000"}},level1:{parent:"default"}}},{}],8:[function(require,module,exports){"use strict";function toggle(on){consoleAvailable()&&(enabled="undefined"==typeof on?!enabled:!!on)}function consoleAvailable(){return"undefined"!=typeof console&&"function"==typeof console.log}var enabled=!1,levels={info:1,debug:2,error:4},level=levels.debug;module.exports={log:function(msg){enabled&&"undefined"!=typeof console&&console.log(msg)},info:function(msg){level>=levels.info&&this.log(msg)},enable:function(){toggle(!0)},disable:function(){toggle(!1)},enabled:function(){return enabled===!0},profile:function(name,callback){console.time(name),callback(),console.timeEnd(name)}}},{}],9:[function(require,module,exports){"use strict";var dispatcher=require("./eventDispatcher"),constants=require("./config/constants"),features=require("./config/features"),events=require("./config/events"),keyCodes={left:37,up:38,right:39,down:40,spacebar:32},eventBinding={bindKeydown:function(){document.addEventListener("keydown",function(e){var code=e.keyCode||e.which;code===keyCodes.left?dispatcher.trigger(events.moveActivePiece,{direction:constants.DIRECTION_LEFT},this):code===keyCodes.right?dispatcher.trigger(events.moveActivePiece,{direction:constants.DIRECTION_RIGHT},this):code===keyCodes.down?dispatcher.trigger(events.moveActivePiece,{direction:constants.DIRECTION_DOWN},this):code===keyCodes.up?features.enabled("testMovementMode")?dispatcher.trigger(events.moveActivePiece,{direction:constants.DIRECTION_UP},this):dispatcher.trigger(events.rotateActivePiece,{direction:constants.DIRECTION_LEFT},this):code===keyCodes.spacebar&&dispatcher.trigger(events.pause)})}};module.exports={init:function(){var i;for(i in eventBinding)eventBinding.hasOwnProperty(i)&&eventBinding[i]()}}},{"./config/constants":3,"./config/events":4,"./config/features":5,"./eventDispatcher":10}],10:[function(require,module,exports){(function(global){"use strict";var eventSubscriptions=(require("./debug"),{});module.exports={subscribe:function(eventName,callback){if("function"==typeof callback){var subscribers=eventSubscriptions[eventName];void 0===subscribers&&(subscribers=eventSubscriptions[eventName]=[]),subscribers.push(callback)}},unsubscribe:function(eventName,callback){var subscribers=eventSubscriptions[eventName];if(void 0!==subscribers){var index=subscribers.indexOf(callback);-1!==index&&subscribers.splice(index,1)}},once:function(eventName,callback){var self=this;this.subscribe(eventName,function(){callback.apply(this,arguments),self.unsubscribe(eventName,callback)})},trigger:function(eventName,data,context){var i,subscribers=eventSubscriptions[eventName];if("undefined"!=typeof subscribers){data=data instanceof Array?data:[data];var window=window||global;for(context=context||window,i=0;i<subscribers.length;i++)subscribers[i].apply(context,data)}},hasSubscriber:function(eventName,callback){return void 0!==eventSubscriptions[eventName]&&-1!==eventSubscriptions[eventName].indexOf(callback)?!0:!1}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":8}],11:[function(require,module,exports){"use strict";var Playfield=require("./models/playfield"),Tetromino=require("./models/tetromino"),SoundEffects=(require("./view/sprite"),require("./soundEffects")),ThemeLoader=require("./themeLoader"),themeConfigs=require("./config/themes"),eventDispatcher=require("./eventDispatcher"),events=require("./config/events"),constants=require("./config/constants"),features=require("./config/features"),debug=require("./debug"),GameEngine=function(){this.activeTetromino=null,this.pieceQueue=[],this.pieceHistory=[],this.level=0,this.gravity=.05,this.accelerateGravity=!1,this.isSuspended=!1,this.paused=!1,this.playfield=new Playfield(Playfield.defaults.xCount,Playfield.defaults.yCount),this.soundEffects=new SoundEffects,this.initThemes(),this.init()};GameEngine.QUEUE_MINIMUM=3,GameEngine.ACCELERATED_GRAVITY=.5,GameEngine.prototype.init=function(){this.bindEvents(),this.advanceNextPiece(),features.enabled("initWithRemnants")&&this.playfield.distributeRandomBlocks(10)},GameEngine.prototype.initThemes=function(){var themeLoader=new ThemeLoader(themeConfigs);this.themeLoader=themeLoader,this.theme=themeLoader.getTheme()},GameEngine.prototype.getTetrominoStyle=function(type){return this.theme.tetrominos[type]?this.theme.tetrominos[type]:null},GameEngine.prototype.bindEvents=function(){var self=this;eventDispatcher.subscribe(events.moveActivePiece,function(movement){self.moveActivePiece(movement)}),eventDispatcher.subscribe(events.rotateActivePiece,function(movement){self.rotateActivePiece(movement)}),eventDispatcher.subscribe(events.accelerateActivePiece,function(){self.accelerate=!0}),eventDispatcher.subscribe(events.deccelerateActivePiece,function(){self.accelerate=!1}),eventDispatcher.subscribe(events.pause,function(){self.togglePause()})},GameEngine.prototype.update=function(){if(!this.isSuspended&&this.shouldMoveDownOnCurrentFrame()){var validDrop=this.playfield.validateBlockPlacement(this.activeTetromino.getBlockCoordinatesForDrop());if(validDrop)this.activeTetromino.drop();else{if(this.activeTetromino.atOrigin())return void this.topOut();eventDispatcher.trigger(events.activePiecePositioned),this.playfield.placeBlocks(this.activeTetromino.releaseBlocks()),this.advanceNextPiece(),this.settleBlocks()}}},GameEngine.prototype.frameCounter=0,GameEngine.prototype.shouldMoveDownOnCurrentFrame=function(){return this.frameCounter+=this.getGravity(),this.frameCounter>=1?(this.frameCounter=0,!0):void 0},GameEngine.prototype.settleBlocks=function(iteration){var self=this,iteration=iteration||0;if(iteration>0&&!this.playfield.settleRows())return void this.resume();var completedRows=this.playfield.getCompletedRows();completedRows.length?(this.isSuspended=!0,this.playfield.clearRows(completedRows),eventDispatcher.trigger(events.rowComplete,completedRows),eventDispatcher.once(events.rowCleared,function(){self.settleBlocks(iteration)})):this.resume()},GameEngine.prototype.resume=function(){this.isSuspended&&(this.isSuspended=!1)},GameEngine.prototype.getGravity=function(){return this.accelerateGravity?GameEngine.ACCELERATED_GRAVITY:this.gravity},GameEngine.prototype.advanceNextPiece=function(){null!==this.activeTetromino&&this.pieceHistory.push(this.activeTetromino.type),this.refreshPieceQueue(),this.activeTetromino=Tetromino.create(this.pieceQueue.shift())},GameEngine.prototype.getNextPiece=function(){return this.pieceQueue[1]},GameEngine.prototype.refreshPieceQueue=function(){this.pieceQueue.length<=GameEngine.QUEUE_MINIMUM&&(this.pieceQueue=this.pieceQueue.concat(Tetromino.randomizeNextBag()))},GameEngine.prototype.togglePause=function(){this.paused=!this.paused,this.paused&&this.topOut()},GameEngine.prototype.topOut=function(){this.isSuspended=!0,eventDispatcher.trigger(events.topOut)},GameEngine.prototype.moveActivePiece=function(movement){var blockOffsetCoordinates,offsetCoordinates={x:0,y:0};if(movement.direction===constants.DIRECTION_LEFT)offsetCoordinates.x=-1;else if(movement.direction===constants.DIRECTION_RIGHT)offsetCoordinates.x=1;else if(movement.direction===constants.DIRECTION_DOWN)offsetCoordinates.y=1;else{if(movement.direction!==constants.DIRECTION_UP||!features.enabled("testMovementMode"))return void debug.log("moveActivePiece: invalid move");offsetCoordinates.y=-1}blockOffsetCoordinates=this.activeTetromino.getBlockCoordinatesForOffset(offsetCoordinates),this.playfield.validateBlockPlacement(blockOffsetCoordinates)?this.activeTetromino.moveByOffset(offsetCoordinates):eventDispatcher.trigger(events.invalidMove,{})},GameEngine.prototype.rotateActivePiece=function(movement){var coordinates=this.activeTetromino.getBlockCoordinatesForRotation(movement.direction),valid=this.playfield.validateBlockPlacement(coordinates);valid&&movement.direction===constants.DIRECTION_LEFT?this.activeTetromino.rotateLeft():valid&&movement.direction===constants.DIRECTION_RIGHT&&this.activeTetromino.rotateRight()},GameEngine.prototype.getProjectedDestination=function(tetromino){for(var offsetY=0,valid=!0;valid;)valid=this.playfield.validateBlockPlacement(tetromino.getBlockCoordinatesForOffset({x:0,y:offsetY+1})),valid&&offsetY++;return{x:tetromino.x,y:tetromino.y+offsetY}},GameEngine.prototype.getGhostPiece=function(){var ghostPiece=Tetromino.create(this.activeTetromino.type),dest=this.getProjectedDestination(this.activeTetromino);return ghostPiece.blocks=this.activeTetromino.blocks,ghostPiece.x=dest.x,ghostPiece.y=dest.y,ghostPiece},module.exports=GameEngine},{"./config/constants":3,"./config/events":4,"./config/features":5,"./config/themes":7,"./debug":8,"./eventDispatcher":10,"./models/playfield":14,"./models/tetromino":15,"./soundEffects":18,"./themeLoader":20,"./view/sprite":29}],12:[function(require,module,exports){"use strict";var Tetris=require("./tetris"),debug=require("./debug");!function(){debug.enable(),window.Tetris=Tetris}()},{"./debug":8,"./tetris":19}],13:[function(require,module,exports){"use strict";var Block=function(x,y){this.x=x,this.y=y,this.width=1,this.height=1,this.type=null};Block.prototype.collidesWith=function(block){return this.x<block.x+block.width&&this.x+this.width>block.x&&this.y<block.y+block.height&&this.y+this.height>block.y},Block.collides=function(blockA,blockB){return blockA.collidesWith(blockB)},module.exports=Block},{}],14:[function(require,module,exports){"use strict";var debug=require("../debug"),Block=require("./block"),Validate=require("../util/validate"),Playfield=function(xCount,yCount){this.xCount=xCount,this.yCount=yCount,this.grid=this.buildGrid()};Playfield.defaults={xCount:10,yCount:22},Playfield.prototype.buildGrid=function(){return new Array(this.yCount)},Playfield.prototype.createEmptyRow=function(){return new Array(this.xCount)},Playfield.prototype.traverseRows=function(callback){for(var i=this.yCount-1;i>=0;i--){var row=this.grid[i];callback(i,row)}},Playfield.prototype.traverseGrid=function(callback){for(var i=0;i<this.yCount;i++)for(var j=0;j<this.xCount;j++){var cell;this.grid[i]&&this.grid[i][j]&&(cell=this.grid[i][j]),callback(cell)}},Playfield.prototype.clearRows=function(rows){var i,iMax=rows.length;for(i=0;iMax>i;i++)this.clearRowAt(rows[i])},Playfield.prototype.clearRowAt=function(y){var row;return y<this.grid.length&&(row=this.grid.splice(y,1)[0],this.grid.unshift([])),row},Playfield.prototype.settleRows=function(){var j,self=this,merges=!1;return self.traverseRows(function(i,targetRow){var topNeighboringRow=self.grid[i-1],mergable=!1;if(targetRow&&topNeighboringRow){for(j=0;j<topNeighboringRow.length;j++)if(topNeighboringRow[j]){if(void 0!==targetRow[j]){mergable=!1;break}mergable=!0}mergable&&(self.grid[i]=self.mergeRows(targetRow,topNeighboringRow),self.clearRowAt(i-1),merges=!0)}}),merges},Playfield.prototype.mergeRows=function(row1,row2){for(var merged=new Array(this.xCount),i=0;i<this.xCount;i++)merged[i]=void 0!==row2[i]?row2[i]:row1[i];return merged},Playfield.prototype.rowComplete=function(y){var complete,i;if("undefined"==typeof this.grid[y])complete=!1;else for(complete=!0,i=0;i<this.xCount;i++)if("undefined"==typeof this.grid[y][i]){complete=!1;break}return complete},Playfield.prototype.getCompletedRows=function(){var self=this,completedRows=[];return this.traverseRows(function(i,row){self.rowComplete(i)&&completedRows.push(i)}),completedRows},Playfield.prototype.cellEmpty=function(cell){var empty=!1;return this.cellInBounds(cell)&&("undefined"==typeof this.grid[cell.y]||"undefined"==typeof this.grid[cell.y][cell.x])&&(empty=!0),empty},Playfield.prototype.cellInBounds=function(cell){return cell.y>=0&&cell.y<this.yCount&&cell.x>=0&&cell.x<this.xCount},Playfield.prototype.validateBlockPlacement=function(blocks){for(var valid=Array.isArray(blocks),i=0;i<blocks.length;i++)if(!this.validateBlock(blocks[i])){valid=!1;break}return valid},Playfield.prototype.validateBlock=function(block){return Validate.coordinates(block)&&this.cellInBounds(block)&&this.cellEmpty(block)},Playfield.prototype.placeBlock=function(block){this.validateBlock(block)?("undefined"==typeof this.grid[block.y]&&(this.grid[block.y]=this.createEmptyRow()),this.grid[block.y][block.x]=block):debug.log("invalid block placement at "+block.x+", "+block.y)},Playfield.prototype.placeBlocks=function(blocks){for(var i=0,iMax=blocks.length;iMax>i;i++)this.placeBlock(blocks[i])},Playfield.prototype.distributeRandomBlocks=function(blockCount){for(var blockTypes=require("./tetrominoTypes").getTypeKeys();0!==blockCount;){var block=new Block(Math.floor(Math.random()*this.xCount),Math.floor(Math.random()*this.yCount));block.type=blockTypes[Math.floor(Math.random()*blockTypes.length)],this.validateBlock(block)&&(this.placeBlock(block),blockCount--)}},module.exports=Playfield},{"../debug":8,"../util/validate":22,"./block":13,"./tetrominoTypes":16}],15:[function(require,module,exports){"use strict";var Block=require("./block"),tetrominos=require("./tetrominoTypes"),constants=require("../config/constants"),Validate=require("../util/validate"),Tetromino=(require("../debug"),function(type,blocks){this.x=3,this.y=0,this.type=type,this.blocks=blocks,this.origin={x:3,y:0}});Tetromino.create=function(typeKey){var type=tetrominos.getType(typeKey);if(type){for(var blockRotations=[],i=0;i<type.blocks.length;i++){for(var blocks=[],j=0;j<type.blocks[i].length;j++){var coordinates=type.blocks[i][j];if(!Validate.coordinates(coordinates))throw new Error("Invalid block coordinates");blocks.push(new Block(coordinates.x,coordinates.y))}blockRotations.push(blocks)}return new Tetromino(typeKey,blockRotations)}throw new Error("Cannot create tetromino of type "+typeKey)},Tetromino.randomizeNextBag=function(){function shuffle(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}return shuffle(tetrominos.getTypeKeys())},Tetromino.prototype.moveByOffset=function(coordinates){Validate.coordinates(coordinates)&&(this.x+=coordinates.x,this.y+=coordinates.y)},Tetromino.prototype.move=function(coordinates){Validate.coordinates(coordinates)&&(this.x=coordinates.x,this.y=coordinates.y)},Tetromino.prototype.drop=function(){this.move({x:this.x,y:this.y+1})},Tetromino.prototype.atOrigin=function(){return this.x===this.origin.x&&this.y===this.origin.y},Tetromino.prototype.getBlockCoordinates=function(){var coordinates=[],self=this;return this.traverseBlocks(function(i,block){coordinates.push({x:self.x+block.x,y:self.y+block.y})}),coordinates},Tetromino.prototype.releaseBlocks=function(){var self=this,blocks=[];return this.traverseBlocks(function(i,block){var absoluteBlock=new Block(block.x+=self.x,block.y+=self.y);absoluteBlock.type=self.type,blocks.push(absoluteBlock)}),blocks},Tetromino.prototype.getBlockCoordinatesForOffset=function(coordinates){if(Validate.coordinates(coordinates)){var offsetX=this.x+coordinates.x,offsetY=this.y+coordinates.y,offsetCoordinates=[];return this.traverseBlocks(function(i,block){offsetCoordinates.push({x:offsetX+block.x,y:offsetY+block.y})}),offsetCoordinates}},Tetromino.prototype.getBlockCoordinatesForDrop=function(){return this.getBlockCoordinatesForOffset({x:0,y:1})},Tetromino.prototype.traverseBlocks=function(callback){var i,iMax=this.blocks[0].length;for(i=0;iMax>i;i++)callback(i,this.blocks[0][i])},Tetromino.prototype.rotate=function(direction){direction=direction||constants.DIRECTION_LEFT,direction===constants.DIRECTION_RIGHT?this.blocks.push(this.blocks.shift()):direction===constants.DIRECTION_LEFT&&this.blocks.unshift(this.blocks.pop())},Tetromino.prototype.getBlockCoordinatesForRotation=function(direction){for(var coordinates=[],rotatedBlocks=this.blocks.length>1?this.blocks[1]:this.blocks[0],rotatedBlocks=direction===constants.DIRECTION_RIGHT?rotatedBlocks:this.blocks[this.blocks.length-1],i=0;i<rotatedBlocks.length;i++)coordinates.push({x:this.x+rotatedBlocks[i].x,y:this.y+rotatedBlocks[i].y});return coordinates},Tetromino.prototype.rotateLeft=function(){this.rotate(constants.DIRECTION_LEFT)},Tetromino.prototype.rotateRight=function(){this.rotate(constants.DIRECTION_RIGHT)},module.exports=Tetromino},{"../config/constants":3,"../debug":8,"../util/validate":22,"./block":13,"./tetrominoTypes":16}],16:[function(require,module,exports){"use strict";var types={i:{blocks:[[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:3,y:1}],[{x:2,y:0},{x:2,y:1},{x:2,y:2},{x:2,y:3}],[{x:0,y:2},{x:1,y:2},{x:2,y:2},{x:3,y:2}],[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:1,y:3}]]},o:{blocks:[[{x:1,y:0},{x:2,y:0},{x:1,y:1},{x:2,y:1}]]},t:{blocks:[[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:2,y:1}],[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:1,y:2}],[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:1}]]},j:{blocks:[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],[{x:1,y:0},{x:2,y:0},{x:1,y:1},{x:1,y:2}],[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:2,y:2}],[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}]]},l:{blocks:[[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:2,y:0}],[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:2,y:2}],[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:0,y:2}],[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:1,y:2}]]},s:{blocks:[[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],[{x:1,y:0},{x:1,y:1},{x:2,y:1},{x:2,y:2}],[{x:1,y:1},{x:2,y:1},{x:0,y:2},{x:1,y:2}],[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:2}]]},z:{blocks:[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}],[{x:2,y:0},{x:2,y:1},{x:1,y:1},{x:1,y:2}],[{x:0,y:1},{x:1,y:1},{x:1,y:2},{x:2,y:2}],[{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:2}]]}};module.exports={types:types,getType:function(typeKey){return"undefined"!=typeof types[typeKey]?types[typeKey]:void 0},getTypeKeys:function(){return Object.keys(types)}}},{}],17:[function(require,module,exports){"use strict";var extend=require("../util/extend"),Theme=function(config){this.parent=null,this.name=Theme.DEFAULT,this.playfield={color:"black"},this.ghostPiece={color:"darkgray"},this.tetrominos={i:{color:"red"},o:{color:"blue"},t:{color:"green"},j:{color:"purple"},l:{color:"yellow"},s:{color:"orange"},z:{color:"magenta"}},this.tetrominoBorder={color:"black"},config&&extend.deepExtend(this,config)};Theme.DEFAULT="default",module.exports=Theme},{"../util/extend":21}],18:[function(require,module,exports){var events=require("./config/events"),sounds=require("./config/sounds"),eventDispatcher=require("./eventDispatcher"),BufferLoader=require("./bufferLoader"),SoundEffects=(require("./debug"),function(){this.isMuted=!0,this.sources={},this.initAudioContext()&&(this.bindEvents(),this.loadSoundFiles())});SoundEffects.prototype.initAudioContext=function(){try{return window.AudioContext=window.AudioContext||window.webkitAudioContext,this.ctx=new AudioContext,!0}catch(e){return!1}},SoundEffects.prototype.bindEvents=function(){var self=this;eventDispatcher.subscribe(events.rotateActivePiece,function(){self.play("activePieceRotate")}),eventDispatcher.subscribe(events.activePiecePositioned,function(){self.play("activePieceLock")}),eventDispatcher.subscribe(events.rowComplete,function(){self.play("rowComplete")}),eventDispatcher.subscribe(events.invalidMove,function(){self.play("invalidMove")}),eventDispatcher.subscribe(events.topOut,function(){self.play("gameOver")})},SoundEffects.prototype.loadSoundFiles=function(){var self=this,bufferLoader=new BufferLoader(self.ctx,sounds,self.onSoundsLoaded);bufferLoader.load()},SoundEffects.prototype.onSoundsLoaded=function(bufferList){for(var key in bufferList)this.sources[key]=this.ctx.createBufferSource(),this.sources[key].buffer=bufferList[key],this.sources[key].connect(this.ctx.destination)},SoundEffects.prototype.play=function(soundKey){!this.isMuted&&this.sources[soundKey]&&this.sources[soundKey].start(0)},module.exports=SoundEffects},{"./bufferLoader":1,"./config/events":4,"./config/sounds":6,"./debug":8,"./eventDispatcher":10}],19:[function(require,module,exports){var GameEngine=require("./gameEngine"),Canvas=require("./view/canvas"),events=require("./config/events"),eventBinding=require("./eventBinding"),eventDispatcher=require("./eventDispatcher"),Tetris=function(canvasElement){canvasElement=canvasElement||Tetris.createCanvasElement();var self=this;this.gameEngine=new GameEngine,this.canvas=new Canvas(canvasElement,this.gameEngine),this.frameId=null,eventBinding.init(),this.run=function(){self.frameId=requestAnimationFrame(self.run),self.gameEngine.update(),self.canvas.draw()},eventDispatcher.subscribe(events.topOut,function(){window.cancelAnimationFrame(self.frameId)})};Tetris.createCanvasElement=function(){},module.exports=Tetris},{"./config/events":4,"./eventBinding":9,"./eventDispatcher":10,"./gameEngine":11,"./view/canvas":25}],20:[function(require,module,exports){"use strict";var extend=require("./util/extend"),Theme=require("./models/theme"),ThemeLoader=function(config){this.config=config};ThemeLoader.prototype.extendThemeConfig=function(themeConfig){if(themeConfig&&themeConfig.hasOwnProperty("parent")){var parentConfig=this.getThemeConfig(themeConfig.parent);parentConfig&&(themeConfig=extend.deepExtend(extend.deepExtend({},parentConfig),themeConfig))}return themeConfig},ThemeLoader.prototype.getThemeConfig=function(themeName){return this.config.hasOwnProperty(themeName)?this.extendThemeConfig(this.config[themeName]):{}},ThemeLoader.prototype.getTheme=function(themeName){return themeName=themeName||Theme.DEFAULT,new Theme(this.getThemeConfig(themeName))},module.exports=ThemeLoader},{"./models/theme":17,"./util/extend":21}],21:[function(require,module,exports){"use strict";function deepObjectExtend(parent,child){for(var prop in child)parent.hasOwnProperty(prop)&&parent[prop]instanceof Object?parent[prop]=deepObjectExtend(parent[prop],child[prop]):parent[prop]=child[prop];return parent}module.exports={deepExtend:deepObjectExtend}},{}],22:[function(require,module,exports){"use strict";var debug=require("../debug"),Validate=function(){};Validate.coordinates=function(coordinates){var valid=coordinates.hasOwnProperty("x")&&coordinates.hasOwnProperty("y")&&Number.isInteger(coordinates.x)&&Number.isInteger(coordinates.y);return valid||(debug.log("Invalid coordinates:"),debug.log(coordinates)),valid},module.exports=Validate},{"../debug":8}],23:[function(require,module,exports){"use strict";var Animation=function(ctx){this.ctx=ctx,this.complete=!1};Animation.prototype.draw=function(){},module.exports=Animation},{}],24:[function(require,module,exports){"use strict";var animations=[];module.exports={draw:function(){return animations.length?(animations[0].draw(),animations[0].complete&&animations.shift(),!0):!1},push:function(animation){return animations.push(animation)}}},{}],25:[function(require,module,exports){"use strict";var eventDispatcher=require("../eventDispatcher"),events=require("../config/events"),dimensions=require("../config/canvasDimensions"),RowCompleteAnimation=(require("./sprite"),require("./rowCompleteAnimation")),animationQueue=(require("./rowCollapseAnimation"),require("./canvasCache"),require("./animationQueue")),features=require("../config/features"),debug=require("../debug"),Canvas=function(canvasElement,gameEngine){this.ctx=null,this.gameEngine=gameEngine,this.init(canvasElement),this.bindEvents()};Canvas.prototype.init=function(canvasElement){canvasElement.getContext&&(this.ctx=canvasElement.getContext("2d"))},Canvas.prototype.bindEvents=function(){var self=this;eventDispatcher.subscribe(events.rowComplete,function(completedRows){animationQueue.push(new RowCompleteAnimation(self.ctx,completedRows))})},Canvas.prototype.draw=function(){this.drawPlayfield(),this.drawRemnantBlocks(),animationQueue.draw()?debug.info("drawing"):(features.enabled("displayGhostPiece")&&this.drawGhostPiece(),this.drawTetromino(this.gameEngine.activeTetromino,this.gameEngine.getTetrominoStyle(this.gameEngine.activeTetromino.type).color,this.gameEngine.theme.tetrominoBorder))},Canvas.prototype.drawPlayfield=function(){this.ctx.fillStyle=this.gameEngine.theme.playfield.color,this.ctx.fillRect(dimensions.playfieldOrigin.x,dimensions.playfieldOrigin.y,dimensions.transpose(this.gameEngine.playfield.xCount),dimensions.transpose(this.gameEngine.playfield.yCount))},Canvas.prototype.drawRemnantBlocks=function(){var self=this;this.gameEngine.playfield.traverseGrid(function(block){"undefined"!=typeof block&&self.drawBlock(dimensions.transpose(block.x),dimensions.transpose(block.y),self.gameEngine.getTetrominoStyle(block.type).color,self.gameEngine.theme.tetrominoBorder)})},Canvas.prototype.drawBlock=function(x,y,fillColor,borderColor){this.ctx.beginPath(),this.ctx.fillStyle=fillColor,this.ctx.fillRect(x,y,dimensions.gridSize,dimensions.gridSize),borderColor&&(this.ctx.lineWidth=dimensions.blockBorderWidth,this.ctx.strokeStyle=borderColor,this.ctx.strokeRect(x,y,dimensions.gridSize,dimensions.gridSize))},Canvas.prototype.drawTetromino=function(tetromino,fillColor,borderColor){var self=this,originX=dimensions.transpose(tetromino.x),originY=dimensions.transpose(tetromino.y);tetromino.traverseBlocks(function(i,block){self.drawBlock(originX+dimensions.transpose(block.x),originY+dimensions.transpose(block.y),fillColor,borderColor)})},Canvas.prototype.drawGhostPiece=function(){this.drawTetromino(this.gameEngine.getGhostPiece(),this.gameEngine.theme.ghostPiece.color)},module.exports=Canvas},{"../config/canvasDimensions":2,"../config/events":4,"../config/features":5,"../debug":8,"../eventDispatcher":10,"./animationQueue":24,"./canvasCache":26,"./rowCollapseAnimation":27,"./rowCompleteAnimation":28,"./sprite":29}],26:[function(require,module,exports){"use strict";module.exports={imageCache:{},addToCache:function(name,image){var cacheCtx,canvasCache=document.createElement("canvas");canvasCache.setAttribute("width",image.width),canvasCache.setAttribute("height",image.height),cacheCtx=canvasCache.getContext("2d"),cacheCtx.drawImage(image,0,0),this.imageCache[name]=canvasCache},retrive:function(name){return this.imageCache[name]?this.imageCache[name]:null}}},{}],27:[function(require,module,exports){"use strict";var RowCollapseAnimation=(require("./animation"),function(ctx,rows){this.ctx=ctx,this.rows=rows,this.complete=!1});RowCollapseAnimation.prototype.draw=function(){},module.exports=RowCollapseAnimation},{"./animation":23}],28:[function(require,module,exports){"use strict";var dimensions=(require("./animation"),require("../config/canvasDimensions")),eventDispatcher=require("../eventDispatcher"),events=require("../config/events"),debug=require("../debug"),OPACITY_CHANGE_RATE=.05,ENDING_OPACITY=.05,RowCompleteAnimation=function(ctx,rows){this.ctx=ctx,this.rows=rows,this.complete=!1,this.opacity=1,this.finalFillColor="#000000",debug.info(rows)};RowCompleteAnimation.prototype.draw=function(){var width=dimensions.transpose(10),height=dimensions.transpose(this.rows.length);this.ctx.beginPath(),this.ctx.fillStyle=this.getFill(),this.ctx.fillRect(dimensions.playfieldOrigin.x,dimensions.transpose(this.rows[this.rows.length-1]),width,height),this.opacity<=ENDING_OPACITY&&(eventDispatcher.trigger(events.rowCleared),this.complete=!0)},RowCompleteAnimation.prototype.getFill=function(){return"rgba(255, 255, 255, "+this.getOpacity()+")"},RowCompleteAnimation.prototype.getOpacity=function(){return this.opacity-=this.opacity*OPACITY_CHANGE_RATE,this.opacity},module.exports=RowCompleteAnimation},{"../config/canvasDimensions":2,"../config/events":4,"../debug":8,"../eventDispatcher":10,"./animation":23}],29:[function(require,module,exports){"use strict";var Sprite=function(color){this.x=0,this.y=0,this.theme=null,this.color=color};module.exports=Sprite},{}]},{},[12]);